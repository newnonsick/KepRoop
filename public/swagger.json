{
  "openapi": "3.0.0",
  "info": {
    "title": "KepRoop API Documentation",
    "version": "1.0"
  },
  "security": [
    {
      "ApiKeyAuth": []
    },
    {
      "BearerAuth": []
    },
    {
      "CookieAuth": []
    }
  ],
  "components": {
    "securitySchemes": {
      "ApiKeyAuth": {
        "type": "apiKey",
        "in": "header",
        "name": "Authorization",
        "description": "Prefix with 'Api-Key ' or 'Bearer kp_'"
      },
      "BearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      },
      "CookieAuth": {
        "type": "apiKey",
        "in": "cookie",
        "name": "accessToken",
        "description": "Browser Session Cookie (Automatically used if logged in)"
      }
    }
  },
  "paths": {
    "0": {
      "0": "/"
    },
    "1": {
      "0": "/"
    },
    "2": {
      "0": " "
    },
    "3": {
      "0": "."
    },
    "4": {
      "0": "."
    },
    "5": {
      "0": "."
    },
    "6": {
      "0": " "
    },
    "7": {
      "0": "("
    },
    "8": {
      "0": "k"
    },
    "9": {
      "0": "e"
    },
    "10": {
      "0": "e"
    },
    "11": {
      "0": "p"
    },
    "12": {
      "0": " "
    },
    "13": {
      "0": "c"
    },
    "14": {
      "0": "o"
    },
    "15": {
      "0": "m"
    },
    "16": {
      "0": "m"
    },
    "17": {
      "0": "e"
    },
    "18": {
      "0": "n"
    },
    "19": {
      "0": "t"
    },
    "20": {
      "0": "s"
    },
    "21": {
      "0": ")"
    },
    "/api/albums/{id}/activity": {
      "get": {
        "tags": [
          "Albums"
        ],
        "summary": "Get album activity",
        "description": "Get activity logs for an album.",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "cursor",
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Activity logs"
          }
        }
      }
    },
    "/api/albums/{id}/favorite": {
      "post": {
        "tags": [
          "Albums"
        ],
        "summary": "Toggle favorite",
        "description": "Add or remove album from favorites.",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Favorite status toggled"
          }
        }
      }
    },
    "/api/albums/{id}/folders/{folderId}": {
      "put": {
        "tags": [
          "Albums"
        ],
        "summary": "Rename folder",
        "description": "Rename a folder.",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "path",
            "name": "folderId",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Folder renamed"
          }
        }
      },
      "delete": {
        "tags": [
          "Albums"
        ],
        "summary": "Delete folder",
        "description": "Delete a folder.",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "path",
            "name": "folderId",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Folder deleted"
          }
        }
      }
    },
    "/api/albums/{id}/folders": {
      "get": {
        "tags": [
          "Albums"
        ],
        "summary": "List folders",
        "description": "List all folders in an album.",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of folders"
          }
        }
      },
      "post": {
        "tags": [
          "Albums"
        ],
        "summary": "Create folder",
        "description": "Create a new folder in an album.",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "name"
                ],
                "properties": {
                  "name": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Folder created"
          }
        }
      }
    },
    "/api/albums/{id}/invite": {
      "post": {
        "tags": [
          "Albums"
        ],
        "summary": "Create invite",
        "description": "Generate an invite link.",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "role"
                ],
                "properties": {
                  "role": {
                    "type": "string",
                    "enum": [
                      "viewer",
                      "editor"
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Invite created"
          }
        }
      },
      "delete": {
        "tags": [
          "Albums"
        ],
        "summary": "Revoke invite",
        "description": "Revoke an existing invite link.",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "role"
                ],
                "properties": {
                  "role": {
                    "type": "string",
                    "enum": [
                      "viewer",
                      "editor"
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Invite revoked"
          }
        }
      },
      "get": {
        "tags": [
          "Albums"
        ],
        "summary": "Get invite",
        "description": "Get the current active invite link for a specific role.",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "role",
            "required": true,
            "schema": {
              "type": "string",
              "enum": [
                "viewer",
                "editor"
              ]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Invite details"
          }
        }
      }
    },
    "/api/albums/{id}/members/{memberId}": {
      "patch": {
        "tags": [
          "Albums"
        ],
        "summary": "Update member role",
        "description": "Update the role of a member.",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "path",
            "name": "memberId",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "role"
                ],
                "properties": {
                  "role": {
                    "type": "string",
                    "enum": [
                      "viewer",
                      "editor",
                      "owner"
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Role updated"
          }
        }
      },
      "delete": {
        "tags": [
          "Albums"
        ],
        "summary": "Remove member",
        "description": "Remove a member from the album or leave the album.",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "path",
            "name": "memberId",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Member removed"
          }
        }
      }
    },
    "/api/albums/{id}/members": {
      "get": {
        "tags": [
          "Albums"
        ],
        "summary": "List members",
        "description": "List all members of an album.",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of members"
          }
        }
      }
    },
    "/api/albums/{id}": {
      "get": {
        "tags": [
          "Albums"
        ],
        "summary": "Get album details",
        "description": "Get album details including images and folders.",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Album details"
          },
          "404": {
            "description": "Album not found"
          }
        }
      },
      "put": {
        "tags": [
          "Albums"
        ],
        "summary": "Update album",
        "description": "Update album metadata.",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "title": {
                    "type": "string"
                  },
                  "description": {
                    "type": "string"
                  },
                  "visibility": {
                    "type": "string",
                    "enum": [
                      "public",
                      "private"
                    ]
                  },
                  "albumDate": {
                    "type": "string",
                    "format": "date-time"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Album updated"
          }
        }
      },
      "delete": {
        "tags": [
          "Albums"
        ],
        "summary": "Delete album",
        "description": "Delete an album and all its contents.",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Album deleted"
          }
        }
      }
    },
    "/api/albums/{id}/trash": {
      "get": {
        "tags": [
          "Albums"
        ],
        "summary": "View trash",
        "description": "List deleted images in the album.",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of deleted images"
          }
        }
      },
      "delete": {
        "tags": [
          "Albums"
        ],
        "summary": "Empty trash / Permanently delete",
        "description": "Permanently delete specific images from trash.",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "imageIds"
                ],
                "properties": {
                  "imageIds": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Images permanently deleted"
          }
        }
      }
    },
    "/api/albums": {
      "get": {
        "tags": [
          "Albums"
        ],
        "summary": "List albums",
        "description": "List albums with filtering, sorting, and pagination.",
        "parameters": [
          {
            "in": "query",
            "name": "cursor",
            "schema": {
              "type": "string"
            },
            "description": "Cursor for pagination"
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer",
              "default": 12
            },
            "description": "Number of items to return"
          },
          {
            "in": "query",
            "name": "filter",
            "schema": {
              "type": "string",
              "enum": [
                "all",
                "mine",
                "shared",
                "favorites"
              ],
              "default": "all"
            },
            "description": "Filter albums by ownership"
          },
          {
            "in": "query",
            "name": "visibility",
            "schema": {
              "type": "string",
              "enum": [
                "public",
                "private"
              ]
            },
            "description": "Filter by visibility"
          },
          {
            "in": "query",
            "name": "search",
            "schema": {
              "type": "string"
            },
            "description": "Search by title or description"
          },
          {
            "in": "query",
            "name": "sortBy",
            "schema": {
              "type": "string",
              "default": "albumDate"
            },
            "description": "Sort field"
          },
          {
            "in": "query",
            "name": "sortDir",
            "schema": {
              "type": "string",
              "enum": [
                "asc",
                "desc"
              ],
              "default": "desc"
            },
            "description": "Sort direction"
          }
        ],
        "responses": {
          "200": {
            "description": "A list of albums"
          }
        }
      },
      "post": {
        "tags": [
          "Albums"
        ],
        "summary": "Create album",
        "description": "Create a new album.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "title"
                ],
                "properties": {
                  "title": {
                    "type": "string"
                  },
                  "description": {
                    "type": "string"
                  },
                  "visibility": {
                    "type": "string",
                    "enum": [
                      "public",
                      "private"
                    ]
                  },
                  "date": {
                    "type": "string",
                    "format": "date-time"
                  },
                  "coverImageKey": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Album created successfully"
          }
        }
      }
    },
    "/api/auth/api-keys": {
      "get": {
        "tags": [
          "Auth"
        ],
        "summary": "List API keys",
        "description": "List all API keys for the authenticated user.",
        "responses": {
          "200": {
            "description": "List of API keys"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      },
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "Create API key",
        "description": "Create a new API key",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "The created API key (only shown once)"
          }
        }
      }
    },
    "/api/auth/google": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "Google Login/Register",
        "description": "Exchanges a Google ID Token for a session.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "idToken"
                ],
                "properties": {
                  "idToken": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Authentication successful"
          }
        }
      }
    },
    "/api/auth/login": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "User login",
        "description": "Authenticates a user and sets session cookies.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "email",
                  "password"
                ],
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email"
                  },
                  "password": {
                    "type": "string",
                    "format": "password"
                  },
                  "remember": {
                    "type": "boolean"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Login successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "user": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "email": {
                          "type": "string"
                        },
                        "name": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Invalid credentials"
          }
        }
      }
    },
    "/api/auth/logout": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "User logout",
        "description": "Clears session cookies.",
        "responses": {
          "200": {
            "description": "Logout successful"
          }
        }
      }
    },
    "/api/auth/me": {
      "get": {
        "tags": [
          "Auth"
        ],
        "summary": "Get current user",
        "description": "Returns the currently authenticated user based on cookies or tokens.",
        "security": [
          {
            "CookieAuth": []
          },
          {
            "BearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Current user data"
          },
          "401": {
            "description": "Not authenticated"
          }
        }
      }
    },
    "/api/auth/refresh": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "Refresh access token",
        "description": "Uses the httpOnly refreshToken cookie to issue a new accessToken.",
        "responses": {
          "200": {
            "description": "Token refreshed successfully"
          },
          "401": {
            "description": "Invalid or expired refresh token"
          }
        }
      }
    },
    "/api/auth/register": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "User registration",
        "description": "Creates a new user account and sets session cookies.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "email",
                  "password",
                  "name"
                ],
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email"
                  },
                  "password": {
                    "type": "string",
                    "format": "password"
                  },
                  "name": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Registration successful"
          },
          "400": {
            "description": "Validation error or user already exists"
          }
        }
      }
    },
    "/api/images/{id}/download-url": {
      "get": {
        "tags": [
          "Images"
        ],
        "summary": "Get download URL",
        "description": "Get a signed URL for downloading an image.",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Download URL"
          }
        }
      }
    },
    "/api/images/{id}": {
      "get": {
        "tags": [
          "Images"
        ],
        "summary": "Get image details",
        "description": "Get image download URLs and metadata.",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Image details"
          },
          "404": {
            "description": "Not found"
          }
        }
      },
      "delete": {
        "tags": [
          "Images"
        ],
        "summary": "Delete image",
        "description": "Soft delete an image.",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Image deleted"
          }
        }
      },
      "patch": {
        "tags": [
          "Images"
        ],
        "summary": "Restore image",
        "description": "Restore a soft-deleted image.",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "action"
                ],
                "properties": {
                  "action": {
                    "type": "string",
                    "enum": [
                      "restore"
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Image restored"
          }
        }
      }
    },
    "/api/images/bulk": {
      "post": {
        "tags": [
          "Images"
        ],
        "summary": "Bulk operations",
        "description": "Perform bulk delete, download, or move operations.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "action",
                  "imageIds",
                  "albumId"
                ],
                "properties": {
                  "action": {
                    "type": "string",
                    "enum": [
                      "delete",
                      "download",
                      "move"
                    ]
                  },
                  "imageIds": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "albumId": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Operation successful"
          }
        }
      }
    },
    "/api/images/register": {
      "post": {
        "tags": [
          "Images"
        ],
        "summary": "Register uploaded image",
        "description": "Register an image after successful client-side upload.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "albumId",
                  "s3KeyOriginal"
                ],
                "properties": {
                  "albumId": {
                    "type": "string"
                  },
                  "s3KeyOriginal": {
                    "type": "string"
                  },
                  "filename": {
                    "type": "string"
                  },
                  "size": {
                    "type": "integer"
                  },
                  "width": {
                    "type": "integer"
                  },
                  "height": {
                    "type": "integer"
                  },
                  "folderId": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Image registered"
          }
        }
      }
    },
    "/api/images": {
      "post": {
        "tags": [
          "Images"
        ],
        "summary": "Confirm upload",
        "description": "Manually confirm an image upload.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "albumId",
                  "s3Key"
                ],
                "properties": {
                  "albumId": {
                    "type": "string"
                  },
                  "s3Key": {
                    "type": "string"
                  },
                  "mimeType": {
                    "type": "string"
                  },
                  "size": {
                    "type": "integer"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Image confirmed"
          }
        }
      }
    },
    "/api/images/upload-url": {
      "post": {
        "tags": [
          "Images"
        ],
        "summary": "Get upload URL",
        "description": "Generate presigned S3 URLs for client-side upload.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "filename",
                  "contentType",
                  "albumId"
                ],
                "properties": {
                  "filename": {
                    "type": "string"
                  },
                  "contentType": {
                    "type": "string"
                  },
                  "albumId": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Presigned URLs generated"
          }
        }
      }
    },
    "/api/images/upload": {
      "post": {
        "tags": [
          "Images"
        ],
        "summary": "Upload image (Server-side)",
        "description": "Upload an image file directly to the server.",
        "requestBody": {
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "required": [
                  "file",
                  "albumId"
                ],
                "properties": {
                  "file": {
                    "type": "string",
                    "format": "binary"
                  },
                  "albumId": {
                    "type": "string"
                  },
                  "folderId": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Image uploaded and processed"
          }
        }
      }
    },
    "/api/invites/accept": {
      "post": {
        "tags": [
          "Invites"
        ],
        "summary": "Accept invite",
        "description": "Accept an album invite code.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "code"
                ],
                "properties": {
                  "code": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Invite accepted"
          }
        }
      }
    },
    "/api/user/profile": {
      "patch": {
        "tags": [
          "User"
        ],
        "summary": "Update profile",
        "description": "Update user profile details (name).",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "name"
                ],
                "properties": {
                  "name": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Profile updated"
          }
        }
      },
      "put": {
        "tags": [
          "User"
        ],
        "summary": "Update password",
        "description": "Change user password.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "newPassword"
                ],
                "properties": {
                  "currentPassword": {
                    "type": "string"
                  },
                  "newPassword": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Password updated"
          }
        }
      }
    }
  },
  "tags": []
}